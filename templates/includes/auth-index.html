{% load i18n trip_tags static %}
<div class="mx-auto mt-8 max-w-7xl">
    {% if fav_trip or latest_trip %}
        {% with trip=fav_trip|default:latest_trip %}
            <!-- Trip Detail Section -->
            <section id="details" class="mb-8">
                <div class="overflow-hidden shadow card card-border bg-base-100">
                    <!-- Top Bar: Title, Actions -->
                    <div class="flex gap-2 justify-between items-center p-3 border-b sm:gap-y-3 sm:p-6 border-base-300">
                        <!-- Mobile: Title and Buttons -->
                        <h2 class="text-xl font-semibold tracking-tight sm:hidden">{{ trip.title }}</h2>
                        <div x-data class="flex gap-1.5 sm:hidden">
                            <button class="btn btn-sm btn-soft"
                                    hx-get="#"
                                    hx-target="#dialog"
                                    hx-swap="innerHTML"
                                    @click="$dispatch('open-modal'); document.activeElement.blur()"
                                    aria-label="{% trans 'Modify trip dates' %}"
                                    disabled>
                                <i class="ph-bold ph-pencil-simple i-md" aria-hidden="true"></i>
                            </button>
                            <button class="btn btn-sm btn-soft"
                                    hx-get="{% url 'trips:trip-dates' trip.pk %}"
                                    hx-target="#dialog"
                                    hx-swap="innerHTML"
                                    @click="$dispatch('open-modal'); document.activeElement.blur()"
                                    aria-label="{% trans 'Modify trip dates' %}">
                                <i class="ph-bold ph-calendar-blank i-md" aria-hidden="true"></i>
                            </button>
                        </div>
                        <!-- Desktop: Full Layout -->
                        <div class="hidden sm:flex sm:gap-2 sm:items-center sm:grow">
                            <h2 class="text-3xl font-semibold tracking-tight">{{ trip.title }}</h2>
                        </div>
                        <div x-data class="hidden gap-2 sm:flex">
                            <button class="btn btn-md btn-soft"
                                    hx-get="#"
                                    hx-target="#dialog"
                                    hx-swap="innerHTML"
                                    @click="$dispatch('open-modal'); document.activeElement.blur()"
                                    aria-label="{% trans 'Modify trip dates' %}"
                                    disabled>
                                <i class="ph-bold ph-pencil-simple i-lg" aria-hidden="true"></i>
                                <span class="hidden sm:inline">{% trans 'Edit trip' %}</span>
                            </button>
                            <button class="btn btn-md btn-soft"
                                    hx-get="{% url 'trips:trip-dates' trip.pk %}"
                                    hx-target="#dialog"
                                    hx-swap="innerHTML"
                                    @click="$dispatch('open-modal'); document.activeElement.blur()"
                                    aria-label="{% trans 'Modify trip dates' %}">
                                <i class="ph-bold ph-calendar-blank i-lg" aria-hidden="true"></i>
                                <span class="hidden sm:inline">{% trans 'Edit Dates' %}</span>
                            </button>
                        </div>
                    </div>
                    <!-- Center: Trip Image -->
                    <figure class="relative w-full h-48 md:h-80">
                        {% if trip.get_image_url %}
                            <img src="{{ trip.get_image_url }}"
                                 alt="{{ trip.title }}"
                                 class="object-cover w-full h-full"
                                 loading="eager">
                        {% else %}
                            <img src="{% static 'img/trip_generic_detail.jpg' %}"
                                 alt="{{ trip.title }}"
                                 class="object-cover w-full h-full"
                                 loading="eager">
                        {% endif %}

                        {% if trip.needs_attribution %}
                            <div class="absolute bottom-3 left-3 py-1 px-2 text-xs text-white rounded bg-black/50">
                                {{ trip.get_attribution_text }}
                            </div>
                        {% endif %}

                        <!-- Status Badge on Image -->
                        <div class="absolute right-3 bottom-3">
                            <span class="badge badge-secondary badge-sm md:badge-lg">{{ trip.get_status_display }}</span>
                        </div>
                    </figure>
                    <!-- Bottom Bar: Trip Details -->
                    <div class="p-3 sm:p-6">
                        <div id="trip-details" class="mb-3 text-sm md:text-base">
                            <div class="flex flex-col gap-y-2 md:flex-row md:gap-y-0 md:gap-x-4 lg:gap-x-6">
                                <!-- Dates Row -->
                                <div class="flex gap-1.5 items-center">
                                    <i class="sm:hidden ph-bold ph-calendar-blank text-base-content/60" aria-hidden="true"></i>
                                    <span class="hidden md:inline">{% trans "Start Date:" %}&nbsp;</span><strong>{{ trip.start_date|date:"d F" }}</strong>
                                    <span class="sm:hidden">&nbsp;-&nbsp;</span>
                                    <span class="hidden md:inline">&nbsp;&nbsp;</span>
                                    <span class="hidden md:inline">{% trans "End Date:" %}&nbsp;</span><strong>{{ trip.end_date|date:"d F" }}</strong>
                                </div>
                                <!-- Destination Row -->
                                <div class="flex gap-1.5 items-center">
                                    <i class="sm:hidden ph-bold ph-path text-base-content/60" aria-hidden="true"></i>
                                    <span class="hidden md:inline">{% trans "Destination:" %}&nbsp;</span><strong>{{ trip.destination }}</strong>
                                </div>
                            </div>
                        </div>
                        <p class="text-sm italic md:text-base text-base-content/80">{{ trip.description }}</p>
                    </div>
                </div>
            </section>
            <!-- Days & Events Section -->
            <section id="days" class="flex flex-col gap-y-4 mb-8">
                {% for day in trip.days.all %}
                    {% include 'trips/includes/day.html' with day=day %}
                {% endfor %}
            </section>
            <!-- Unpaired Events Section -->
            {% if unpaired_events %}
                <section id="unpaired" class="mb-8">
                    <div class="shadow card card-border bg-base-100" x-data>
                        <div class="card-body">
                            <h2 class="text-xl font-medium sm:text-2xl grow">{% trans 'Unpaired Events' %}</h2>
                            <ul class="flex flex-wrap gap-3 justify-center my-4">
                                {% for event in unpaired_events %}
                                    <c-unpaired-event :event="event" :days="trip.days.all" icon="{{ event|event_icon }}" border_color="{{ event|event_border_color }}" bg_color="{{ event|event_bg_color }}" icon_color="{{ event|event_icon_color }}" />
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </section>
            {% endif %}
        {% endwith %}
        <!-- Other Trips Section -->
        {% if other_trips %}
            <section id="other-trips" class="mb-8">
                <h2 class="mb-6 text-2xl font-semibold ms-2">{% trans 'Other Trips' %}</h2>
                <div class="grid grid-cols-1 gap-x-4 gap-y-8 md:grid-cols-2 xl:grid-cols-3">
                    {% for trip in other_trips %}
                        <div class="shadow card card-border bg-base-100">
                            <div class="card-body">
                                <span class="badge badge-outline badge-secondary">{{ trip.get_status_display }}</span>
                                <h3 class="card-title">{{ trip.title }}</h3>
                                <div class="flex items-center">
                                    <span>
                                        {% if trip.start_date and trip.end_date %}
                                            {{ trip.start_date|date:"SHORT_DATE_FORMAT" }}&nbsp;-&nbsp;{{ trip.end_date|date:"SHORT_DATE_FORMAT" }}
                                        {% else %}
                                            - / -
                                        {% endif %}
                                    </span>
                                </div>
                                <p class="mb-3 italic text-base-content/80">{{ trip.description }}</p>
                                <div class="justify-end text-right">
                                    <a href="{% url 'trips:trip-detail' trip.id %}"
                                       class="btn btn-sm btn-primary btn-soft">{% trans 'Edit' %}</a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </section>
        {% endif %}
    {% else %}
        <p>{% trans 'You have no trips yet!' %}</p>
    {% endif %}
</div>
