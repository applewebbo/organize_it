{% load i18n trip_tags %}
<div class="container py-4 px-0 mx-auto xl:px-6">
    <div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
        {% if map %}
            <div class="map-container">{{ map|safe }}</div>
        {% else %}
            <div class="my-4 md:my-5 alert alert-info alert-soft">
                <i class="ph-bold ph-info i-md text-info"></i>
                {% trans 'No events to display on a map for this day' %}
            </div>
        {% endif %}
        <div class="hidden lg:block">
            <ul class="text-lg list">
                {% if locations.arrival_transfer %}
                    <li class="flex gap-2 items-center p-3 mb-4 bg-red-50 rounded-lg list-row dark:bg-red-950">
                        <div class="flex gap-2 items-center grow">
                            {% if locations.arrival_transfer.type == 1 %}
                                <i class="text-2xl text-red-600 dark:text-red-400 ph-bold ph-airplane-takeoff"></i>
                            {% elif locations.arrival_transfer.type == 2 %}
                                <i class="text-2xl text-red-600 dark:text-red-400 ph-bold ph-train"></i>
                            {% elif locations.arrival_transfer.type == 3 %}
                                <i class="text-2xl text-red-600 dark:text-red-400 ph-bold ph-car"></i>
                            {% else %}
                                <i class="text-2xl text-red-600 dark:text-red-400 ph-bold ph-bus"></i>
                            {% endif %}
                            <a hx-get="{% url 'trips:edit-main-transfer' pk=locations.arrival_transfer.pk %}"
                               hx-target="#dialog"
                               hx-swap="innerHTML"
                               @click="$dispatch('open-modal'); document.activeElement.blur()"
                               class="font-semibold link">
                                {% if locations.arrival_transfer.type == 1 or locations.arrival_transfer.type == 2 %}
                                    {{ locations.arrival_transfer.destination_name }}
                                {% else %}
                                    {{ locations.arrival_transfer.destination_address }}
                                {% endif %}
                            </a>
                            <span class="badge badge-sm badge-success">{{ locations.arrival_transfer.end_time|time:"H:i" }}</span>
                        </div>
                        <button class="btn btn-xs btn-outline"
                                hx-get="{% url 'trips:edit-main-transfer' pk=locations.arrival_transfer.pk %}"
                                @click="$dispatch('open-modal'); document.activeElement.blur()"
                                hx-target="#dialog"
                                hx-swap="innerHTML">
                            <i class="ph-bold ph-pencil-simple i-sm"></i>
                        </button>
                    </li>
                {% endif %}
                {% if locations.stay %}
                    <li class="flex flex-col mb-1 list-row">
                        <div class="flex gap-2 items-center">
                            <div class="flex gap-2 items-center grow">
                                <i class="text-xl ph-bold ph-bed i-sm text-sky-500"></i>
                                <a hx-get="{% url 'trips:stay-detail' locations.stay.pk %}"
                                   hx-target="#dialog"
                                   hx-swap="innerHTML"
                                   @click="$dispatch('open-modal'); document.activeElement.blur()"
                                   class="link">{{ locations.stay.name }}</a>
                                {% if locations.first_day %}
                                    <span class="badge badge-sm badge-outline badge-success">{{ locations.stay.check_in|time:"H:i" }}</span>
                                {% endif %}
                                {% if locations.next_day_stay or locations.last_day %}
                                    <span class="badge badge-sm badge-outline badge-error">{{ locations.stay.check_out|time:"H:i" }}</span>
                                {% endif %}
                            </div>
                            {% if locations.can_add_stay_transfer %}
                                <button class="btn btn-xs btn-outline"
                                        hx-get="{% url 'trips:create-stay-transfer' locations.day.pk %}"
                                        @click="$dispatch('open-modal'); document.activeElement.blur()"
                                        hx-target="#dialog"
                                        hx-swap="innerHTML"
                                        aria-label="{% trans 'Add transfer to next stay' %}">
                                    <i class="ph-bold ph-path i-sm"></i>
                                </button>
                            {% elif locations.stay_transfer_out %}
                                <button class="relative btn btn-xs btn-outline"
                                        hx-get="{% url 'trips:edit-stay-transfer' locations.stay_transfer_out.pk %}"
                                        @click="$dispatch('open-modal'); document.activeElement.blur()"
                                        hx-target="#dialog"
                                        hx-swap="innerHTML"
                                        aria-label="{% trans 'Edit transfer' %}">
                                    <i class="ph-bold ph-path i-sm"></i>
                                    <span class="absolute -top-1 rounded-full size-2.5 bg-slate-400 -end-1"></span>
                                </button>
                            {% endif %}
                            <button class="relative btn btn-xs btn-outline"
                                    hx-get="{% url 'trips:stay-notes' locations.stay.pk %}"
                                    @click="$dispatch('open-modal'); document.activeElement.blur()"
                                    hx-target="#dialog"
                                    hx-swap="innerHTML">
                                <i class="ph-bold ph-paperclip i-sm"></i>
                                <span class="absolute size-2.5 text-xs font-bold text-white {% if locations.stay.notes %}bg-slate-400 {% else %} bg-transparent {% endif %}  rounded-full -top-1 -end-1"></span>
                            </button>
                        </div>
                        {% if locations.stay_transfer_out %}
                            {% with mode=locations.stay_transfer_out.transport_mode %}
                                <div class="flex gap-2 items-center -mt-1 text-sm ps-5 text-slate-500 dark:text-slate-400">
                                    <i class="ph-bold i-sm {% if mode == 'driving' %}ph-car{% endif %} {% if mode == 'walking' %}ph-person-simple-walk{% endif %} {% if mode == 'bicycling' %}ph-bicycle{% endif %} {% if mode == 'transit' %}ph-train{% endif %}"
                                       aria-hidden="true"></i>
                                    <i class="ph-bold ph-arrow-right i-xs" aria-hidden="true"></i>
                                    <span class="truncate">{{ locations.next_day_stay.name }}</span>
                                    {% if locations.stay_transfer_out.google_maps_url %}
                                        <a href="{{ locations.stay_transfer_out.google_maps_url }}"
                                           target="_blank"
                                           rel="noopener noreferrer"
                                           class="btn btn-xs btn-outline ms-2"
                                           aria-label="{% trans 'Open in Google Maps' %}">
                                            <i class="ph-bold ph-map-trifold i-sm" aria-hidden="true"></i>
                                        </a>
                                    {% endif %}
                                </div>
                            {% endwith %}
                        {% endif %}
                    </li>
                {% endif %}
                {% for event in locations.events %}
                    <c-event-list-item :event="event" icon="{{ event|event_icon }}" border_color="{{ event|event_border_color }}" bg_color="{{ event|event_bg_color }}" icon_color="{{ event|event_icon_color }}" :transfer_from="event.transfer_from"></c-event-list-item>
                {% endfor %}
                {% if locations.next_day_stay %}
                    <li class="flex gap-2 items-center py-1 mb-2 list-row">
                        <i class="text-xl ph-bold ph-bed i-sm text-sky-500"></i>
                        <a hx-get="{% url 'trips:stay-detail' locations.next_day_stay.pk %}"
                           hx-target="#dialog"
                           hx-swap="innerHTML"
                           @click="$dispatch('open-modal'); document.activeElement.blur()"
                           class="link">{{ locations.next_day_stay.name }}</a><span class="badge badge-sm badge-outline badge-success">{{ locations.next_day_stay.check_in|time:"H:i" }}</span>
                    </li>
                {% endif %}
                {% if locations.departure_transfer %}
                    <li class="flex gap-2 items-center p-3 mt-4 bg-red-50 rounded-lg list-row dark:bg-red-950">
                        <div class="flex gap-2 items-center grow">
                            {% if locations.departure_transfer.type == 1 %}
                                <i class="text-2xl text-red-600 dark:text-red-400 ph-bold ph-airplane-takeoff"></i>
                            {% elif locations.departure_transfer.type == 2 %}
                                <i class="text-2xl text-red-600 dark:text-red-400 ph-bold ph-train"></i>
                            {% elif locations.departure_transfer.type == 3 %}
                                <i class="text-2xl text-red-600 dark:text-red-400 ph-bold ph-car"></i>
                            {% else %}
                                <i class="text-2xl text-red-600 dark:text-red-400 ph-bold ph-bus"></i>
                            {% endif %}
                            <a hx-get="{% url 'trips:edit-main-transfer' pk=locations.departure_transfer.pk %}"
                               hx-target="#dialog"
                               hx-swap="innerHTML"
                               @click="$dispatch('open-modal'); document.activeElement.blur()"
                               class="font-semibold link">
                                {% if locations.departure_transfer.type == 1 or locations.departure_transfer.type == 2 %}
                                    {{ locations.departure_transfer.origin_name }}
                                {% else %}
                                    {{ locations.departure_transfer.origin_address }}
                                {% endif %}
                            </a>
                            <span class="badge badge-sm badge-error">{{ locations.departure_transfer.start_time|time:"H:i" }}</span>
                        </div>
                        <button class="btn btn-xs btn-outline"
                                hx-get="{% url 'trips:edit-main-transfer' pk=locations.departure_transfer.pk %}"
                                @click="$dispatch('open-modal'); document.activeElement.blur()"
                                hx-target="#dialog"
                                hx-swap="innerHTML">
                            <i class="ph-bold ph-pencil-simple i-sm"></i>
                        </button>
                    </li>
                {% endif %}
            </ul>
        </div>
    </div>
</div>
